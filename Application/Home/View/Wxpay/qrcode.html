<!DOCTYPE HTML>
 <html>
 <head>
    <meta charset="UTF-8">
    <title>微信安全支付</title>
     <style>
         /*body{*/
             /*background: url("/Public/Home/images/common/headerimg_01.jpg") no-repeat;*/
             /*background-size: cover;*/
         /*}*/
     </style>
 </head>
 <body>
    <div align="center" id="qrcode">
    </div>
    <div align="center">
        <p>订单号：<?php echo $out_trade_no; ?></p>
        <input type="hidden" name="orderID" value="<?php echo $out_trade_no; ?>">
    </div>
  
    <br>
    <div align="center">
        <a href="/Home/User/index">返回个人中心</a>
    </div>
 </body>
    <script src="__PUBLIC__/js/qrcode.js"></script>
    <script>
        if(<?php echo $unifiedOrderResult["code_url"] != NULL; ?>)
        {
            var url = "<?php echo $code_url;?>";
            //参数1表示图像大小，取值范围1-10；参数2表示质量，取值范围'L','M','Q','H'
            var qr = qrcode(10, 'M');
            qr.addData(url);
            qr.make();
            var wording=document.createElement('p');
            wording.innerHTML = "请扫描下面二维码完成付款！";
            var code=document.createElement('DIV');
            code.innerHTML = qr.createImgTag();
            var element=document.getElementById("qrcode");
            element.appendChild(wording);
            element.appendChild(code);
        }
    </script>

 <script>
     var t = setInterval(function () {
         wasPaied();
     },100);

     function wasPaied() {
         var xmlhttp;
         if(window.XMLHttpRequest){
//            for others
             xmlhttp = new XMLHttpRequest();
         }
         else{
//             for IE6
             xmlhttp = new ActiveXObject();
         }
         xmlhttp.onreadystatechange = function () {
             if(xmlhttp.readyState === 4 && xmlhttp.status === 200){
                 var data = JSON.parse(xmlhttp.responseText);
                 if (data === "1"){
                     clearInterval(t);
                     appendSuccessMsg();
                     setTimeout(function () {
                         window.location.href = '/Home/User/index';
                     },1000);
                 }
             }
         }
         var orderID = document.getElementsByTagName('input')[0].value;
         xmlhttp.open('get','/Home/Wxpay/check?orderID=' + orderID);
         xmlhttp.send();
     }

     function appendSuccessMsg() {
//         只向页面中添加一个成功信息
         if (!document.getElementById('Msg')){
             var target = document.getElementsByTagName("body")[0];
             var node = document.createTextNode('支付成功,即将跳转页面...');
             var p = document.createElement('p');
             p.appendChild(node);
             p.style.textAlign = 'center';
             p.id = 'Msg';
             target.appendChild(p);
         }
     }
 </script>
 </html>